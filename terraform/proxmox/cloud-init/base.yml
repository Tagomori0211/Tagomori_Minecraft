#cloud-config
timezone: Asia/Tokyo

# ユーザー作成とSSH鍵の設定 (ここが足りていなかった！)
users:
  - name: tagomori
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh_authorized_keys:
      - ${ssh_public_key}

package_update: true
package_upgrade: true

packages:
  - python3
  - python3-pip
  - curl
  - git

# SSH設定のセキュリティ強化
write_files:
  - path: /etc/ssh/sshd_config.d/99-custom.conf
    content: |
      PasswordAuthentication yes
      PubkeyAuthentication yes
      PermitRootLogin no

runcmd:
  - systemctl restart sshd
  - echo 'Base setup complete - ready for Ansible'

final_message: "VM ready for Ansible provisioning"
