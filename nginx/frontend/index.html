<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Resource Monitor</title>
    <style>
        /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #181b1f; /* å…¨ä½“ã‚‚Grafanaã«è¿‘ã¥ã‘ã‚‹ */
            color: #ffffff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† */
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        h1 { margin: 0; font-size: 2.5rem; color: #4CAF50; }
        .subtitle { color: #aaaaaa; margin-top: 10px; }

        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (ã‚«ãƒ¼ãƒ‰ã‚’ä¸¦ã¹ã‚‹) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        /* ãƒ‘ãƒãƒ«ï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .card {
            background: #111217; /* Grafanaã®æ¨™æº–ãƒ€ãƒ¼ã‚¯èƒŒæ™¯è‰²ã«çµ±ä¸€ */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            text-align: center;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-5px); }

        .card h2 { font-size: 1.2rem; color: #81C784; margin-bottom: 10px; }
        .card .value { font-size: 2.5rem; font-weight: bold; margin: 10px 0; }
        .card .unit { font-size: 1rem; color: #bbbbbb; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ãƒ³ãƒ— */
        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: gray;
            margin-right: 5px;
        }
        .status-online { background-color: #00E676; box-shadow: 0 0 10px #00E676; }
        .status-offline { background-color: #F44336; }

        /* ã‚°ãƒ©ãƒ•åŸ‹ã‚è¾¼ã¿ç”¨iframe */
        .chart-frame {
            width: 100%;
            height: 150px;
            border: none;
            margin-top: 10px;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <header>
        <h1>â›ï¸ Minecraft Monitor ğŸ“Š</h1>
        <div class="subtitle">DevOps VM Dashboard (Managed by Flask)</div>
    </header>

    <div class="dashboard-grid">
        
        <div class="card">
            <h2>Server Status</h2>
            <div id="status-text" class="value">Loading...</div>
            <div class="unit">
                <span id="status-icon" class="status-indicator"></span> 
                <span id="uptime">Checking...</span>
            </div>
            <div style="margin-top: 10px; font-size: 0.9rem; color: #aaaaaa;">
                Ping: <span id="ping-value">-</span> ms
            </div>
        </div>

        <div class="card">
            <h2>Players Online</h2>
            <div class="value" style="display: flex; align-items: baseline; justify-content: center;">
                <span id="players-online" style="font-size: 3.5rem; color: #ffffff; text-shadow: 0 0 10px rgba(255,255,255,0.2);">0</span>
                
                <span class="unit" style="font-size: 1.5rem; color: #666666; margin-left: 5px;">/ <span id="players-max">25</span></span>
            </div>
            <div class="unit" style="margin-top: -5px;">Active Users</div>
        </div>

        <div class="card">
            <h2>CPU Usage</h2>
            <div class="unit">Pod Resource</div>
            <iframe class="chart-frame" 
                src="/grafana/d-solo/adv2gdt/iflame?orgId=1&from=now-5m&to=now&refresh=5s&theme=dark&panelId=1" 
                frameborder="0">
            </iframe>
        </div>

        <div class="card">
            <h2>Memory Usage</h2>
            <div class="unit" id="mem-details">Checking Limit...</div>
            <iframe class="chart-frame" 
                src="/grafana/d-solo/adv2gdt/iflame?orgId=1&from=now-5m&to=now&refresh=5s&theme=dark&panelId=2" 
                frameborder="0">
            </iframe>
        </div>

        <div class="card">
            <h2>Network In</h2>
            <div class="unit">Traffic Receive</div>
            <iframe class="chart-frame" 
                src="/grafana/d-solo/adv2gdt/iflame?orgId=1&from=now-5m&to=now&refresh=5s&theme=dark&panelId=4" 
                frameborder="0">
            </iframe>
        </div>

        <div class="card">
            <h2>Network Out</h2>
            <div class="unit">Traffic Transmit</div>
            <iframe class="chart-frame" 
                src="/grafana/d-solo/adv2gdt/iflame?orgId=1&from=now-5m&to=now&refresh=5s&theme=dark&panelId=3" 
                frameborder="0">
            </iframe>
        </div>

    </div>

    <script>
        async function fetchStats() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                // 1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                const statusText = document.getElementById('status-text');
                const statusIcon = document.getElementById('status-icon');
                const uptimeElement = document.getElementById('uptime');

                statusText.textContent = data.status;
                if (data.status === "Online") {
                    statusText.style.color = "#00E676";
                    statusIcon.className = "status-indicator status-online";
                    uptimeElement.textContent = "Ver: " + data.server.version; 
                } else {
                    statusText.style.color = "#F44336";
                    statusIcon.className = "status-indicator status-offline";
                    uptimeElement.textContent = "Checking...";
                }

                // 2. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°æ›´æ–°
                document.getElementById('players-online').textContent = data.players.online;
                document.getElementById('players-max').textContent = data.players.max;

                
                // 3. ãƒ¡ãƒ¢ãƒªä¸Šé™è¡¨ç¤ºã®æ›´æ–° (ã‚°ãƒ©ãƒ•ã¯iframeä»»ã›)
                const memDetails = document.getElementById('mem-details');
                if (data.server.memory_limit !== "N/A") {
                    memDetails.textContent = "Limit: " + data.server.memory_limit;
                    memDetails.style.color = "#81C784"; 
                } else {
                    memDetails.textContent = "Checking Limit...";
                    memDetails.style.color = "#bbbbbb";
                }


                const pingEl = document.getElementById('ping-value');
                    pingEl.textContent = data.server.latency;
                    if (data.server.latency < 50) pingEl.style.color = "#00E676"; // ç·‘ (çˆ†é€Ÿ)
                        else if (data.server.latency < 100) pingEl.style.color = "#FFEB3B"; // é»„ (æ™®é€š)
                else pingEl.style.color = "#F44336";

            } catch (error) {
                console.error("Fetch error:", error);
                document.getElementById('status-text').textContent = "Error";
            }
        }

        // åˆå›å®Ÿè¡Œ & 5ç§’ã”ã¨ã«æ›´æ–°
        fetchStats();
        setInterval(fetchStats, 5000);
    </script>
</body>
</html>