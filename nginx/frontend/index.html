<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Resource Monitor</title>
    <style>
        /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2d2d2d; /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰èƒŒæ™¯ */
            color: #ffffff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† */
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        h1 { margin: 0; font-size: 2.5rem; color: #4CAF50; }
        .subtitle { color: #aaaaaa; margin-top: 10px; }

        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (ã‚«ãƒ¼ãƒ‰ã‚’ä¸¦ã¹ã‚‹) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        /* ãƒ‘ãƒãƒ«ï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .card {
            background: #111217;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            text-align: center;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-5px); } /* ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼ã§å°‘ã—æµ®ã */

        .card h2 { font-size: 1.2rem; color: #81C784; margin-bottom: 10px; }
        .card .value { font-size: 2.5rem; font-weight: bold; margin: 10px 0; }
        .card .unit { font-size: 1rem; color: #bbbbbb; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ãƒ³ãƒ— */
        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: gray;
            margin-right: 5px;
        }
        .status-online { background-color: #00E676; box-shadow: 0 0 10px #00E676; }
        .status-offline { background-color: #F44336; }
        
        .chart-frame {
            width: 100%;      /* è¦ªè¦ç´ (card)ã®å¹…ã„ã£ã±ã„ã«åºƒã’ã‚‹ */
            height: 150px;    /* é«˜ã•ã¯å›ºå®šã§ã‚‚OK (Gaugeãªã‚‰å°‘ã—ä½ã‚ãŒã„ã„ã‹ã‚‚) */
            border: none;     /* æ ç·šã‚’æ¶ˆã™ */
            margin-top: 10px;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’å‡ºã•ãªã„ */
        }

    </style>
</head>
<body>

    <header>
        <h1>â›ï¸ Minecraft Monitor ğŸ“Š</h1>
        <div class="subtitle">DevOps VM Dashboard (Managed by Flask)</div>
    </header>

    <div class="dashboard-grid">
        
        <div class="card">
            <h2>Server Status</h2>
            <div id="status-text" class="value">Loading...</div>
            <div><span id="status-icon" class="status-indicator"></span> <span id="uptime">Checking...</span></div>
        </div>

        <div class="card">
            <h2>Players Online</h2>
            <div class="value"><span id="players-online">-</span> <span class="unit">/ <span id="players-max">-</span></span></div>
            <div class="unit">Now/Max</div>
        </div>

        <div class="card">
            <h2>CPU Usage</h2>
            <div class="unit">Pod Resource</div>
            
            <iframe class="chart-frame" 
                src="http://192.168.0.21:3000/d-solo/adxfmzb/iflame?orgId=1&from=now-5m&to=now&refresh=1s&panelId=1" 
                width="100%" 
                height="150" 
                frameborder="0">
            </iframe>
        </div>

        <div class="card">
            <h2>Memory Usage</h2>
            <div class="unit" id="mem-details">Checking Max...</div>
            <div class="unit" id="mem-details">RAM Allocation</div>
        
            

            <iframe class="chart-frame" 
                src="http://192.168.0.21:3000/d-solo/adxfmzb/iflame?orgId=1&from=now-5m&to=now&refresh=1s&panelId=2" 
                width="100%" 
                height="150" 
                frameborder="0">
            </iframe>
        </div>

        <div class="card">
            <h2>Network In</h2>
            <div class="unit">Traffic Receive</div>
            
            <iframe class="chart-frame" 
                src="http://localhost:3000/d-solo/adxfmzb/iflame?orgId=1&timezone=browser&showCategory=Thresholds&panelId=panel-3&__feature.dashboardSceneSolo=true" 
                width="100%" 
                height="150" 
                frameborder="0">
            </iframe>
        </div>

        <div class="card">
            <h2>Network Out</h2>
            <div class="unit">Traffic Transmit</div>
            
            <iframe class="chart-frame" 
                src="http://192.168.0.21:3000/d-solo/adxfmzb/iflame?orgId=1&timezone=browser&showCategory=Thresholds&panelId=panel-4&__feature.dashboardSceneSolo=true"
                width="100%" 
                height="150" 
                frameborder="0">
            </iframe>
            
        </div>

    </div>

    <script>
        // APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ç”»é¢ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        async function fetchStats() {
            try {
                // Flaskã®APIã‚’å©ã (/api/ã¯Nginxã§Flaskã«è»¢é€ã•ã‚Œã‚‹è¨­å®šæ¸ˆã¿)
                const response = await fetch('/api/status');
                const data = await response.json();

                // 1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°
                const statusText = document.getElementById('status-text');
                const statusIcon = document.getElementById('status-icon');
                const uptimeElement = document.getElementById('uptime');

                statusText.textContent = data.status;
                if (data.status === "Online") {
                    statusText.style.color = "#00E676";
                    statusIcon.className = "status-indicator status-online";
                    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’è¡¨ç¤ºï¼
                    uptimeElement.textContent = "Ver: " + data.server.version; 
                } else {
                    statusText.style.color = "#F44336";
                    statusIcon.className = "status-indicator status-offline";
                    uptimeElement.textContent = "Checking...";
                }

                // 2. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°æ›´æ–°
                document.getElementById('players-online').textContent = data.players.online;
                document.getElementById('players-max').textContent = data.players.max;

                const memDetails = document.getElementById('mem-details');
                    if (data.server.memory_limit !== "N/A") {
                    // "Limit: 4.0 GB" ã®ã‚ˆã†ã«å›ºå®šæƒ…å ±ã‚’è¡¨ç¤º
                        memDetails.textContent = "Limit: " + data.server.memory_limit;
                        memDetails.style.color = "#81C784"; 
                    } else {
                        memDetails.textContent = "Checking Limit...";
                        memDetails.style.color = "#bbbbbb";
                }

            } catch (error) {
                console.error("ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                document.getElementById('status-text').textContent = "Error";
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«1å›å®Ÿè¡Œ
        fetchStats();

        // ãã®å¾Œã¯5ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–° (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ„Ÿï¼)
        setInterval(fetchStats, 5000);
    </script>
</body>
</html>
